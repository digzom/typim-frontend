# ADR-007: Contract-Focused Test Scaffolding

## Status

Accepted

## Context

Regression findings required tests that fail on contract violations before runtime fixes are merged.

## Decision

Expand unit and e2e suites with contract-focused scenarios:

- Dispatch invalid-action rejection and idempotency behavior.
- Event envelope source propagation and exception isolation.
- Ctrl+W guard matrix in e2e.
- Mobile layout and overflow checks at `390x844`.

## Consequences

### Positive

- Acceptance scenarios map directly to remediation steps.
- CI provides earlier detection of contract drift.

### Negative

- E2E runtime increases for targeted matrix checks.

### Neutral

- Existing smoke tests remain alongside new contract tests.

## Related

- `tests/unit/core/state.test.ts`
- `tests/unit/core/event-bus.test.ts`
- `tests/e2e/shortcuts.spec.ts`
- `tests/e2e/layout.spec.ts`
